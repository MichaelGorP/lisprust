(define map (lambda (f l) (if (null? l) '() (cons (f (car l)) (map f (cdr l)))))) (define error (lambda (a b) 0)) (define deriv (lambda (a) (if (not (pair? a)) (if (eq? a 'x) 1 0) (if (eq? (car a) '+) (cons '+ (map deriv (cdr a))) (if (eq? (car a) '-) (cons '- (map deriv (cdr a))) (if (eq? (car a) '*) (list '* a (cons '+ (map (lambda (a) (list '/ (deriv a) a)) (cdr a)))) (if (eq? (car a) '/) (list '- (list '/ (deriv (cadr a)) (caddr a)) (list '/ (cadr a) (list '* (caddr a) (caddr a) (deriv (caddr a))))) (error #f 0)))))))) (deriv '(+ x 3))
